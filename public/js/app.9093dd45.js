(function(){var e={1904:function(){},1144:function(e,t,a){"use strict";var s=a(6116),n=function(){var e=this,t=e._self._c;return t("div",[t("ed-header"),t("ed-body"),t("ed-footer")],1)},i=[],r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"header-length"}},[t("div",{staticClass:"ed-header"},[t("div",{staticClass:"day-box"},[t("div",{on:{click:e.goLastWeek}},[e._v("往前◀")]),e._v("  "),t("div",[e._v(e._s(e.displayDate))]),e._v("  "),t("div",{on:{click:e.goNextWeek}},[e._v("▶往后")]),e._v("  ")]),e._v("         "),t("label",{attrs:{id:"ios_ui_switch"}},[t("input",{attrs:{type:"checkbox"},domProps:{checked:e.isEditable},on:{click:e.switchButton}}),t("span",{staticClass:"slider"})]),e._v(" 解锁编辑 ")])])},o=[];a(3248);function l(e){const t=new Date(e),a=t.getDay(),s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-a+1),n=[];for(let i=0;i<7;i++)n.push(new Date(s.getFullYear(),s.getMonth(),s.getDate()+i));return n}function u(e){switch(e=e.slice(0,3),e=e.toLowerCase(),e){case"mon":return 1;case"tue":return 2;case"wed":return 3;case"thu":return 4;case"fri":return 5;case"sat":return 6;case"sun":return 7;default:return null}}function c(e){e=new Date(e);let t=new Date,a=t.getDay();a=0===a?7:a;const s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-a+1),n=new Date(s.getFullYear(),s.getMonth(),s.getDate()+7),i=new Date(s.getFullYear(),s.getMonth(),s.getDate()-7),r=new Date(n.getFullYear(),n.getMonth(),n.getDate()+7);return e>=s&&e<n?"本周":e>=i&&e<s?"往前":e>=n&&e<r?"往后":e.toLocaleDateString()}var d={name:"EdHeader",props:[],data(){return{isEditable:!1,date:new Date}},computed:{displayDate(){return c(this.date)}},methods:{switchButton(){this.isEditable=!this.isEditable,this.$bus.$emit("iseditablechange",this.isEditable)},weekPlus(e,t){const a=new Date(e);return a.setDate(a.getDate()+7*t),a},goNextWeek(){this.date=this.weekPlus(this.date,1),this.$bus.$emit("changeDate",this.date)},goLastWeek(){this.date=this.weekPlus(this.date,-1),this.$bus.$emit("changeDate",this.date)}}},h=d,f=a(2528),p=(0,f.c)(h,r,o,!1,null,"4ddaa1f2",null),m=p.exports,v=function(){var e=this,t=e._self._c;return t("div")},_=[],b={name:"EdFooter",props:[]},g=b,D=(0,f.c)(g,v,_,!1,null,null,null),w=D.exports,y=function(){var e=this,t=e._self._c;return t("div",[t("form",{directives:[{name:"show",rawName:"v-show",value:e.iseditable,expression:"iseditable"}],staticClass:"bodyrow-add-schedule",on:{submit:function(t){return t.preventDefault(),e.addNewDataset.apply(null,arguments)}}},[t("div",[t("span"),t("button",{staticClass:"add-button"},[e._v("Add New")]),t("select",{directives:[{name:"model",rawName:"v-model",value:e.newScheduleData.pos,expression:"newScheduleData.pos"}],on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.newScheduleData,"pos",t.target.multiple?a:a[0])}}},[t("option",{attrs:{value:"host"}},[e._v("host")]),t("option",{attrs:{value:"bartender"}},[e._v("bartender")]),t("option",{attrs:{value:"server"}},[e._v("server")]),t("option",{attrs:{value:"busser"}},[e._v("busser")]),t("option",{attrs:{value:"trainee"}},[e._v("trainee")]),t("option",{attrs:{value:"reserved"}},[e._v("reserved")])])]),t("div",{staticClass:"input-worker-group"},e._l(e.workers,(function(a){return t("label",{key:a.split("-")[2]},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.newScheduleData.id_name,expression:"newScheduleData.id_name"}],attrs:{type:"checkbox"},domProps:{value:a.split("-")[2]+"-"+a.split("-")[3],checked:Array.isArray(e.newScheduleData.id_name)?e._i(e.newScheduleData.id_name,a.split("-")[2]+"-"+a.split("-")[3])>-1:e.newScheduleData.id_name},on:{change:function(t){var s=e.newScheduleData.id_name,n=t.target,i=!!n.checked;if(Array.isArray(s)){var r=a.split("-")[2]+"-"+a.split("-")[3],o=e._i(s,r);n.checked?o<0&&e.$set(e.newScheduleData,"id_name",s.concat([r])):o>-1&&e.$set(e.newScheduleData,"id_name",s.slice(0,o).concat(s.slice(o+1)))}else e.$set(e.newScheduleData,"id_name",i)}}}),e._v(" "+e._s(a.split("-")[3])),"partTime"==a.split("-")[0]?t("sup",{staticStyle:{color:"blue"}},[e._v(" PT")]):e._e()])})),0)]),t("br"),t("div",e._l(e.datasets,(function(a,s){return t("tbody",{key:s,class:"table "+s},[t("tr",{staticClass:"header-date"},[t("th",[e._v("pos")]),t("th",[e._v("name")]),t("td",[e._v(e._s(e.returnDate(1)))]),t("td",[e._v(e._s(e.returnDate(2)))]),t("td",[e._v(e._s(e.returnDate(3)))]),t("td",[e._v(e._s(e.returnDate(4)))]),t("td",[e._v(e._s(e.returnDate(5)))]),t("td",[e._v(e._s(e.returnDate(6)))]),t("td",[e._v(e._s(e.returnDate(7)))])]),e._l(a,(function(a,n){return t("table-row",{key:n,attrs:{schedule:a,pos:s,id_name:n,iseditable:e.iseditable}})})),t("br")],2)})),0),t("button",{staticClass:"submit-button",on:{click:e.submitScheduleData}},[e._v("Update Data")]),t("a",{attrs:{id:"refreshPageDate",hidden:""},on:{click:function(t){return t.preventDefault(),e.refreshPageDate()}}})])},k=[],S=a(2964),$=function(){var e=this,t=e._self._c;return t("tr",[t("th",[t("button",{directives:[{name:"show",rawName:"v-show",value:e.iseditable,expression:"iseditable"}],on:{click:function(t){return e.delScheduleRow_e(e.pos,e.id_name,e.iseditable)}}},[e._v(" DEL")]),e._v("  "+e._s(e.pos)+" ")]),t("th",{attrs:{"data-id_name":e.id_name}},[e._v(e._s(e.id_name.split("-")[1]))]),t("td",{class:e.schedule.mon[0],attrs:{"data-saved":e.schedule.mon[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"mon")}}},[e._v(" "+e._s(e.schedule.mon[0])+" ")]),t("td",{class:e.schedule.tue[0],attrs:{"data-saved":e.schedule.tue[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"tue")}}},[e._v(" "+e._s(e.schedule.tue[0])+" ")]),t("td",{class:e.schedule.wed[0],attrs:{"data-saved":e.schedule.wed[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"wed")}}},[e._v(" "+e._s(e.schedule.wed[0])+" ")]),t("td",{class:e.schedule.thu[0],attrs:{"data-saved":e.schedule.thu[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"thu")}}},[e._v(" "+e._s(e.schedule.thu[0])+" ")]),t("td",{class:e.schedule.fri[0],attrs:{"data-saved":e.schedule.fri[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"fri")}}},[e._v(" "+e._s(e.schedule.fri[0])+" ")]),t("td",{class:e.schedule.sat[0],attrs:{"data-saved":e.schedule.sat[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"sat")}}},[e._v(" "+e._s(e.schedule.sat[0])+" ")]),t("td",{class:e.schedule.sun[0],attrs:{"data-saved":e.schedule.sun[1]},on:{click:function(t){return e.changeShift_emit(e.pos,e.id_name,"sun")}}},[e._v(" "+e._s(e.schedule.sun[0])+" ")])])},O=[],j={name:"TableRow",props:["schedule","pos","id_name","iseditable"],data(){return{}},methods:{changeShift_emit(e,t,a){this.$bus.$emit("changeshift",e,t,a)},delScheduleRow_e(e,t,a){a&&this.$bus.$emit("delScheduleRow",e,t)}}},E=j,x=(0,f.c)(E,$,O,!1,null,"390433dc",null),C=x.exports;let N=[{name:"Jacky",number:"23820",status:"onJob",posNumber:"1"}],P=[{idnum:"23918",pos:"host",time:"thu_pm",name:"Jesse"},{idnum:"23918",pos:"busser",time:"sun_pm",name:"Jesse"}];function T(e){let t=[];for(let s=0;s<e.length;s++){let a=e[s].pos,[n,i]=e[s].time.split("_"),r=e[s].idnum+"-"+e[s].name,o={pos:a,id_name:r,day:n,shift:i};t.push(o)}let a={};for(let s=0;s<t.length;s++){let e=t[s].pos,n=t[s].id_name,i=t[s].day;a[e]||(a[e]={}),a[e][n]||(a[e][n]={}),a[e][n][i]||(a[e][n][i]=[]),a[e][n][i].push(t[s].shift)}for(let[s,n]of Object.entries(a))for(let[e,t]of Object.entries(n)){
//!先将周某天有数据的替换成要求的格式。
for(let[i,r]of Object.entries(t))if(1==r.length){let t=r[0];a[s][e][i]={0:`${t}`,1:"true"}}else 2==r.length&&(a[s][e][i]={0:"all",1:"true"});
//!再将周某天缺的数据补上，补上值为空。
let n=["mon","tue","wed","thu","fri","sat","sun"];for(let t of n)a[s][e][`${t}`]||(a[s][e][`${t}`]={0:"off",1:"true"})}return a}function J(e){let t=[];return e.forEach((e=>{t.push(e.status+"-"+e.posNumber+"-"+e.number+"-"+e.name)})),t.sort(),t}var F={name:"EdBody",components:{TableRow:C},props:[],data(){return{refreshData:T(P),datasets:T(P),iseditable:!1,countClick:0,clickEventData:{},workers:J(N),newScheduleData:{pos:"server",id_name:[]},displayDate:new Date}},computed:{dbScheduleData(){let e=[];
//!遍历datasets数据。
for(let[t,a]of Object.entries(this.datasets))for(let[s,n]of Object.entries(a))for(let[a,i]of Object.entries(n)){let n={};if("all"!=i[0]&&"am"!=i[0]&&"pm"!=i[0]||(n.employeename=s.split("-")[1],n.employeenumber=s.split("-")[0],
//!根据日期和星期得到正确的日期。
n.workdate=l(this.displayDate)[u(a)-1].toLocaleDateString(),n.createdate=new Date,n.position=t,n.remarks=""),"all"==i[0]){n.shift="am",e.push(n);let t=JSON.parse(JSON.stringify(n));t.createdate=new Date,t.shift="pm",e.push(t)}else"am"==i[0]?(n.shift="am",e.push(n)):"pm"==i[0]&&(n.shift="pm",e.push(n))}return e},scheduleByWorker(){let e={};for(let t of Object.values(this.datasets))for(let[a,s]of Object.entries(t))for(let[t,n]of Object.entries(s))e[a]||(e[a]={}),e[a][t]||(e[a][t]=[]),"all"==n[0]?(e[a][t].push("am"),e[a][t].push("pm")):"am"!=n[0]&&"pm"!=n[0]||e[a][t].push(n[0]);return e}},methods:{iseditablechange(e){this.iseditable=e},changeshift(e,t,a){
//!先判断iseditable是false,则直接跳出
if(!this.iseditable)return console.log("no edit table's data ",this.countClick++),void(this.countClick%5===0&&alert('can not edit now, if you want change a shift, go switch the button "解锁编辑'));this.clickEventData.path=[e,t,a],this.clickEventData.oldValue=[],this.clickEventData.oldValue.push(this.datasets[e][t][a][0]),this.clickEventData.oldValue.push(this.datasets[e][t][a][1]);
//!找到key为id_name的对象,修改day下的值,轮'','all','pm','am'
let s=this.datasets[e][t][a][0];this.datasets[e][t][a][0]="off"==s?"am":"am"==s?"all":"all"==s?"pm":"off",this.refreshData[e]&&this.refreshData[e][t]&&this.datasets[e][t][a][0]==this.refreshData[e][t][a][0]?this.datasets[e][t][a][1]="true":this.datasets[e][t][a][1]="false"},delScheduleRow(e,t){confirm("确定删除该行工作的时间安排!!!")&&this.$delete(this.datasets[e],[t])},addNewDataset(){let e=this.newScheduleData.pos,t=this.newScheduleData.id_name;t.forEach((t=>{this.datasets[e]||this.$set(this.datasets,[e],{}),this.datasets[e][t]||this.$set(this.datasets[e],[t],{mon:{0:"off",1:"false"},tue:{0:"off",1:"false"},wed:{0:"off",1:"false"},thu:{0:"off",1:"false"},fri:{0:"off",1:"false"},sat:{0:"off",1:"false"},sun:{0:"off",1:"false"}})}))},submitScheduleData(){
//!获取数据库格式data
let e=this.dbScheduleData,t=this;async function a(e){let a=await fetch("/admin/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await a.json();return console.log("submitData response.json():",s),
//!返回成功时。刷新refreshData和datasets数据。并且弹出保存数据成功弹窗。
t.refreshPageDate(),alert("数据已上传保存"),s}console.log(e),
//!提交data
a(e)},changeDate(e){this.displayDate=e},returnDate(e){let t=l(this.displayDate)[e-1];return t.toLocaleDateString("en-US",{month:"numeric",weekday:"short",day:"numeric"})},refreshPageDate(e=this.displayDate.toLocaleDateString()){let t=this;
//!获取新日期下的db数据
async function a(e){let a;await S.c.get(`/admin/tabledata?date=${e}`,{headers:{"Content-Type":"application/json"}}).then((e=>a=e.data)).catch((e=>console.log(e)));let s=T(a);s&&(t.datasets=JSON.parse(JSON.stringify(s)),t.refreshData=JSON.parse(JSON.stringify(s)))}async function s(){let e=await fetch("/admin/getemployeedb").then((e=>e.json())).catch((e=>{console.log("fetch得到ep db err:"+e)})),a=J(e);a&&(t.workers=a)}a(e),s()}},watch:{iseditable(e){e&&(this.countClick=0)},datasets:{deep:!0,handler(){console.log("schedule改动了");for(let[e,t]of Object.entries(this.scheduleByWorker))for(let[a,s]of Object.entries(t))
//!发现某人某星期有重复的am或者PM的班次
s.length>new Set(s).size&&(alert(`${e}的星期--${a}--的时间安排有冲突. 请重新调整!`),this.datasets[this.clickEventData.path[0]][e][a][0]=this.clickEventData.oldValue[0],this.datasets[this.clickEventData.path[0]][e][a][1]=this.clickEventData.oldValue[1])}},displayDate:{immediate:!0,handler(){this.refreshPageDate()}}},mounted(){this.$bus.$on("iseditablechange",this.iseditablechange),this.$bus.$on("changeshift",this.changeshift),this.$bus.$on("delScheduleRow",this.delScheduleRow),this.$bus.$on("changeDate",this.changeDate)},beforeDestroy(){this.$bus.$off("iseditablechange"),this.$bus.$off("changeshift"),this.$bus.$off("delScheduleRow"),this.$bus.$off("changeDate")}},M=F,R=(a(1904),(0,f.c)(M,y,k,!1,null,"49ee916b",null)),L=R.exports,A={name:"App",data(){return{show:!1}},components:{EdHeader:m,EdFooter:w,EdBody:L}},B=A,W=(0,f.c)(B,n,i,!1,null,"6246c3a4",null),Y=W.exports;s.cp.config.productionTip=!1,new s.cp({beforeCreate(){s.cp.prototype.$bus=this},render:e=>e(Y)}).$mount("#app")}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,a),i.exports}a.m=e,function(){var e=[];a.O=function(t,s,n,i){if(!s){var r=1/0;for(c=0;c<e.length;c++){s=e[c][0],n=e[c][1],i=e[c][2];for(var o=!0,l=0;l<s.length;l++)(!1&i||r>=i)&&Object.keys(a.O).every((function(e){return a.O[e](s[l])}))?s.splice(l--,1):(o=!1,i<r&&(r=i));if(o){e.splice(c--,1);var u=n();void 0!==u&&(t=u)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[s,n,i]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var n,i,r=s[0],o=s[1],l=s[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(l)var c=l(a)}for(t&&t(s);u<r.length;u++)i=r[u],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return a.O(c)},s=self["webpackChunkz3paiban_vue"]=self["webpackChunkz3paiban_vue"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[999],(function(){return a(1144)}));s=a.O(s)})();
//# sourceMappingURL=app.9093dd45.js.map